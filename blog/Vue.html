<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue AQ | blog-demo</title>
    <meta name="description" content="Vuepress blog demo">
    
    
    <link rel="preload" href="/blog-demo/assets/css/0.styles.21daa4a3.css" as="style"><link rel="preload" href="/blog-demo/assets/js/app.f512fc54.js" as="script"><link rel="preload" href="/blog-demo/assets/js/2.50c16c5d.js" as="script"><link rel="preload" href="/blog-demo/assets/js/8.4a61413f.js" as="script"><link rel="prefetch" href="/blog-demo/assets/js/3.a01b05e6.js"><link rel="prefetch" href="/blog-demo/assets/js/4.971fb7ff.js"><link rel="prefetch" href="/blog-demo/assets/js/5.d6913d93.js"><link rel="prefetch" href="/blog-demo/assets/js/6.3f10aeab.js"><link rel="prefetch" href="/blog-demo/assets/js/7.6615c753.js"><link rel="prefetch" href="/blog-demo/assets/js/9.f68989a5.js">
    <link rel="stylesheet" href="/blog-demo/assets/css/0.styles.21daa4a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog-demo/" class="home-link router-link-active"><!----> <span class="site-name">blog-demo</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog-demo/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog-demo/blog/FirstBlog.html" class="nav-link">FirstBlog</a></div><div class="nav-item"><a href="/blog-demo/blog/Vue.html" class="nav-link router-link-exact-active router-link-active">Vue</a></div><div class="nav-item"><a href="/blog-demo/blog/KuaYu.html" class="nav-link">JS</a></div> <a href="https://github.com/yi-fish/blog-demo.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog-demo/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog-demo/blog/FirstBlog.html" class="nav-link">FirstBlog</a></div><div class="nav-item"><a href="/blog-demo/blog/Vue.html" class="nav-link router-link-exact-active router-link-active">Vue</a></div><div class="nav-item"><a href="/blog-demo/blog/KuaYu.html" class="nav-link">JS</a></div> <a href="https://github.com/yi-fish/blog-demo.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/blog-demo/" class="sidebar-link">首页</a></li><li><a href="/blog-demo/blog/FirstBlog.html" class="sidebar-link">我的第一篇博客</a></li><li><a href="/blog-demo/blog/Vue.html" class="active sidebar-link">Vue.$nextTick</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/blog/Vue.html#try" class="sidebar-link">try</a></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/Vue.html#一、doctype的作用" class="sidebar-link">一、DOCTYPE的作用</a></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/Vue.html#二、严格模式和混杂模式" class="sidebar-link">二、严格模式和混杂模式</a></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/Vue.html#三、如何区分严格模式和混杂模式" class="sidebar-link">三、如何区分严格模式和混杂模式</a></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/Vue.html#javascript变量：-变量命名原则" class="sidebar-link">JavaScript变量： 变量命名原则</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/blog/Vue.html#全名原则" class="sidebar-link">全名原则</a></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/Vue.html#一、简单理解vue中的nexttick" class="sidebar-link">一、简单理解Vue中的nextTick</a></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/Vue.html#二、应用场景" class="sidebar-link">二、应用场景</a></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/Vue.html#三、nexttick源码浅析" class="sidebar-link">三、nextTick源码浅析</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/Vue.html#part-2" class="sidebar-link">part 2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/blog/Vue.html#四、nexttick源码浅析" class="sidebar-link">四、nextTick源码浅析</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/Vue.html#part-3" class="sidebar-link">part 3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/blog/Vue.html#五、" class="sidebar-link">五、</a></li></ul></li></ul></li><li><a href="/blog-demo/blog/KuaYu.html" class="sidebar-link">JS跨域 内核 闭包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/blog/KuaYu.html#在读这篇文章之前，你需要了解的？" class="sidebar-link">在读这篇文章之前，你需要了解的？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog-demo/blog/KuaYu.html#paste-image-png" class="sidebar-link">Paste_Image.png</a></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/KuaYu.html#我们是如果通过浏览器访问页面的？" class="sidebar-link">我们是如果通过浏览器访问页面的？</a></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/KuaYu.html#相同域？" class="sidebar-link">相同域？</a></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/KuaYu.html#单项跨域" class="sidebar-link">单项跨域</a></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/KuaYu.html#window-name" class="sidebar-link">window.name</a></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/KuaYu.html#双向跨域" class="sidebar-link">双向跨域</a></li><li class="sidebar-sub-header"><a href="/blog-demo/blog/KuaYu.html#window-postmessage" class="sidebar-link">window.postMessage</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-aq"><a href="#vue-aq" class="header-anchor">#</a> Vue AQ</h1> <h2 id="try"><a href="#try" class="header-anchor">#</a> try</h2> <p>链接：https://www.nowcoder.com/questionTerminal/41cdfbc12f69419cbb84a8d0f644117f</p> <p>call（）方法和apply（）方法的作用相同，他们的区别在于接收参数的方式不同。对于call（），第一个参数是this值没有变化，变化的是其余参数都直接传递给函数。（在使用call（）方法时，传递给函数的参数必须逐个列举出来。使用apply（）时，传递给函数的是参数数组）如下代码做出解释：</p> <p>function add(c, d){
return this.a + this.b + c + d;
}
var o = {a:1, b:3};
add.call(o, 5, 7); // 1 + 3 + 5 + 7 = 16
add.apply(o, [10, 20]); // 1 + 3 + 10 + 20 = 34</p> <h2 id="一、doctype的作用"><a href="#一、doctype的作用" class="header-anchor">#</a> 一、DOCTYPE的作用</h2> <p>那么，它的作用是什么呢？</p> <p>首先，这个声明不是 HTML 标签，而是一种语法格式。
DOCTYPE是定义浏览器使用什么样的文本类型定义（DTD）载入页面，也就是告诉浏览器使用什么样的HTML或者XHTML规范来解析html。一般情况下出现在html文档的开头。
xhtml中有四种模式：</p> <ul><li>1.xhtml 1.0 Strict 严格模式，不包含展示性与弃用的标签，不允许框架集(framesets)，且严格以xml格式来编写标记;</li> <li></li> <li>2.xhtml 1.0 Transitional 过滤模式，包含展示性与弃用标签，不允许框架集(framesets)，且严格以xml格式来编写标记;</li> <li></li> <li>3.xhtml 1.0 Frameset 宽松模式，包含展示性与弃用标签，允许框架集(framesets)，且严格以xml格式来编写标记;</li> <li></li> <li>4.xhtml 1.1，等同于xhtml 1.0 strict，但允许添加模型。</li></ul> <h2 id="二、严格模式和混杂模式"><a href="#二、严格模式和混杂模式" class="header-anchor">#</a> 二、严格模式和混杂模式</h2> <p>严格模式，又称标准模式，是指浏览器按照W3C标准来解析代码，一种严格要求的DTD，排版和JS运作模式均是以该浏览器支持的最高标准运行。</p> <p>混杂模式，又称怪异模式或者兼容模式，是指浏览器按照自己的方式来解析代码，页面以宽松的向后兼容的方式显示，就严格度上来说不如严格模式，但是模拟老式浏览器的行为可以防止站点无法工作。</p> <h2 id="三、如何区分严格模式和混杂模式"><a href="#三、如何区分严格模式和混杂模式" class="header-anchor">#</a> 三、如何区分严格模式和混杂模式</h2> <p>区分的重点在于文档的DTD：</p> <ul><li>1.如果文档中包含了严格的DOCTYPE，那么它一般以严格模式呈现。</li> <li>2.如果文档中包含过渡DTD和URI的DOCTYPE，也以严格模式呈现，但有过渡DTD而没有URI，会导致文档以混杂模式呈现。</li> <li>3.DOCTYPE不存在或者形式不正确或有误，文档以混杂模式呈现。</li> <li>4.HTML5没有DTD，因此也就没有严格模式与混杂模式的区分，HTML5相对来说语法比较宽松。</li></ul> <h2 id="javascript变量：-变量命名原则"><a href="#javascript变量：-变量命名原则" class="header-anchor">#</a> JavaScript变量： 变量命名原则</h2> <p>变量的命名相对而言没有太多的技术含量，今天整理有关于变量命名相关的原则，主要是想告诉大家，虽然命名没有技术含量，但对于个人编码，或者说一个团队的再次开发及阅读是相当有用的。良好的书写规范可以让你的JavaScript代码更上一个台阶，也更有利于团队的再次开发和阅读代码。</p> <h3 id="全名原则"><a href="#全名原则" class="header-anchor">#</a> 全名原则</h3> <ul><li>变量名区分大小写，允许包含字母、数字、美元符号($)和下划线，但第一个字符不允许是数字，不允许包含空格和其他标点符号</li> <li>变量命名长度应该尽可能的短，并抓住要点，尽量在变量名中体现出值的类型</li> <li>尽量避免使用没有意义的命名</li> <li>禁止使用JavaScript关键词、保留字全名</li> <li>变量名命名方法常见的有匈牙利命名法、驼峰命名法和帕斯卡命名法</li></ul> <h3 id="一、简单理解vue中的nexttick"><a href="#一、简单理解vue中的nexttick" class="header-anchor">#</a> 一、简单理解Vue中的nextTick</h3> <blockquote><p>Vue中的nextTick涉及到Vue中DOM的异步更新，感觉很有意思，特意了解了一下。其中关于nextTick的源码涉及到不少知识，很多不太理解，暂且根据自己的一些感悟介绍下nextTick。</p></blockquote> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token number">1.</span> <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
<span class="token number">2.</span>   <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token string">&quot;msgDiv&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>msg<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token number">3.</span>   <span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;msg1&quot;</span><span class="token operator">&gt;</span>Message got outside $nextTick<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>msg1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token number">4.</span>   <span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;msg2&quot;</span><span class="token operator">&gt;</span>Message got inside $nextTick<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>msg2<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token number">5.</span>   <span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;msg3&quot;</span><span class="token operator">&gt;</span>Message got outside $nextTick<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>msg3<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token number">6.</span>   <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;changeMsg&quot;</span><span class="token operator">&gt;</span>
<span class="token number">7.</span>     Change the Message
<span class="token number">8.</span>   <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token number">9.</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><h3 id="二、应用场景"><a href="#二、应用场景" class="header-anchor">#</a> 二、应用场景</h3> <h4 id="下面了解下nexttick的主要应用的场景及原因。"><a href="#下面了解下nexttick的主要应用的场景及原因。" class="header-anchor">#</a> 下面了解下nextTick的主要应用的场景及原因。</h4> <blockquote><p>在Vue生命周期的created()钩子函数进行的DOM操作一定要放在Vue.nextTick()的回调函数中
在created()钩子函数执行的时候DOM 其实并未进行任何渲染，而此时进行DOM操作无异于徒劳，所以此处一定要将DOM操作的js代码放进Vue.nextTick()的回调函数中。与之对应的就是mounted()钩子函数，因为该钩子函数执行时所有的DOM挂载和渲染都已完成，此时在该钩子函数中进行任何DOM操作都不会有问题 。</p></blockquote> <blockquote><p>在数据变化后要执行的某个操作，而这个操作需要使用随数据改变而改变的DOM结构的时候，这个操作都应该放进Vue.nextTick()的回调函数中。
具体原因在Vue的官方文档中详细解释：</p></blockquote> <blockquote><p>Vue 异步执行 DOM 更新。只要观察到数据变化，Vue 将开启一个队列，并缓冲在同一事件循环中发生的所有数据改变。如果同一个 watcher 被多次触发，只会被推入到队列中一次。这种在缓冲时去除重复数据对于避免不必要的计算和 DOM 操作上非常重要。然后，在下一个的事件循环“tick”中，Vue 刷新队列并执行实际 (已去重的) 工作。Vue 在内部尝试对异步队列使用原生的 Promise.then 和MessageChannel，如果执行环境不支持，会采用 setTimeout(fn, 0)代替。</p></blockquote> <blockquote><p>例如，当你设置vm.someData = 'new value'，该组件不会立即重新渲染。当刷新队列时，组件会在事件循环队列清空时的下一个“tick”更新。多数情况我们不需要关心这个过程，但是如果你想在 DOM 状态更新后做点什么，这就可能会有些棘手。虽然 Vue.js 通常鼓励开发人员沿着“数据驱动”的方式思考，避免直接接触 DOM，但是有时我们确实要这么做。为了在数据变化之后等待 Vue 完成更新 DOM ，可以在数据变化之后立即使用Vue.nextTick(callback) 。这样回调函数在 DOM 更新完成后就会调用。</p></blockquote> <ul><li>作者：Ruheng</li> <li>链接：https://www.jianshu.com/p/a7550c0e164f</li> <li>来源：简书</li></ul> <h3 id="三、nexttick源码浅析"><a href="#三、nexttick源码浅析" class="header-anchor">#</a> 三、nextTick源码浅析</h3> <h4 id="作用"><a href="#作用" class="header-anchor">#</a> 作用</h4> <p>Vue.nextTick用于<strong>延迟执行一段代码</strong>，它接受2个参数（回调函数和执行回调函数的上下文环境），如果没有提供回调函数，那么将返回promise对象。</p> <h4 id="源码"><a href="#源码" class="header-anchor">#</a> 源码</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1.</span> <span class="token comment">/*** Defer a task to execute it asynchronously.*/</span>
<span class="token number">2.</span> 
<span class="token number">3.</span> <span class="token keyword">export</span> <span class="token keyword">const</span> nextTick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">4.</span>   <span class="token keyword">const</span> callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token number">5.</span>   <span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token number">6.</span>   <span class="token keyword">let</span> timerFunc
<span class="token number">7.</span> 
<span class="token number">8.</span>   <span class="token keyword">function</span> <span class="token function">nextTickHandler</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">9.</span>     pending <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token number">10.</span>     <span class="token keyword">const</span> copies <span class="token operator">=</span> callbacks<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token number">11.</span>     callbacks<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">12.</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> copies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">13.</span>       copies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">14.</span>     <span class="token punctuation">}</span>
<span class="token number">15.</span>   <span class="token punctuation">}</span>
<span class="token number">16.</span> 
<span class="token number">17.</span>   <span class="token comment">// the nextTick behavior leverages the microtask queue, which can be accessed</span>
<span class="token number">18.</span>   <span class="token comment">// via either native Promise.then or MutationObserver.</span>
<span class="token number">19.</span>   <span class="token comment">// MutationObserver has wider support, however it is seriously bugged in</span>
<span class="token number">20.</span>   <span class="token comment">// UIWebView in iOS &gt;= 9.3.3 when triggered in touch event handlers. It</span>
<span class="token number">21.</span>   <span class="token comment">// completely stops working after triggering a few times... so, if native</span>
<span class="token number">22.</span>   <span class="token comment">// Promise is available, we will use it:</span>
<span class="token number">23.</span>   <span class="token comment">/* istanbul ignore if */</span>
<span class="token number">24.</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNative</span><span class="token punctuation">(</span>Promise<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">25.</span>     <span class="token keyword">var</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">26.</span>     <span class="token keyword">var</span> <span class="token function-variable function">logError</span> <span class="token operator">=</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token number">27.</span>     <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token number">28.</span>       p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>nextTickHandler<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>logError<span class="token punctuation">)</span>
<span class="token number">29.</span>       <span class="token comment">// in problematic UIWebViews, Promise.then doesn't completely break, but</span>
<span class="token number">30.</span>       <span class="token comment">// it can get stuck in a weird state where callbacks are pushed into the</span>
<span class="token number">31.</span>       <span class="token comment">// microtask queue but the queue isn't being flushed, until the browser</span>
<span class="token number">32.</span>       <span class="token comment">// needs to do some other work, e.g. handle a timer. Therefore we can</span>
<span class="token number">33.</span>       <span class="token comment">// &quot;force&quot; the microtask queue to be flushed by adding an empty timer.</span>
<span class="token number">34.</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>isIOS<span class="token punctuation">)</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>noop<span class="token punctuation">)</span>
<span class="token number">35.</span>     <span class="token punctuation">}</span>
<span class="token number">36.</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isIE <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> MutationObserver <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
<span class="token number">37.</span>     <span class="token function">isNative</span><span class="token punctuation">(</span>MutationObserver<span class="token punctuation">)</span> <span class="token operator">||</span>
<span class="token number">38.</span>     <span class="token comment">// PhantomJS and iOS 7.x</span>
<span class="token number">39.</span>     MutationObserver<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object MutationObserverConstructor]'</span>
<span class="token number">40.</span>   <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">41.</span>     <span class="token comment">// use MutationObserver where native Promise is not available,</span>
<span class="token number">42.</span>     <span class="token comment">// e.g. PhantomJS, iOS7, Android 4.4</span>
<span class="token number">43.</span>     <span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">1</span>
<span class="token number">44.</span>     <span class="token keyword">var</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>nextTickHandler<span class="token punctuation">)</span>
<span class="token number">45.</span>     <span class="token keyword">var</span> textNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">46.</span>     observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>textNode<span class="token punctuation">,</span> <span class="token punctuation">{</span>
<span class="token number">47.</span>       characterData<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token number">48.</span>     <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token number">49.</span>     <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token number">50.</span>       counter <span class="token operator">=</span> <span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span>
<span class="token number">51.</span>       textNode<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span>
<span class="token number">52.</span>     <span class="token punctuation">}</span>
<span class="token number">53.</span>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token number">54.</span>     <span class="token comment">// fallback to setTimeout</span>
<span class="token number">55.</span>     <span class="token comment">/* istanbul ignore next */</span>
<span class="token number">56.</span>     <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token number">57.</span>       <span class="token function">setTimeout</span><span class="token punctuation">(</span>nextTickHandler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token number">58.</span>     <span class="token punctuation">}</span>
<span class="token number">59.</span>   <span class="token punctuation">}</span>
<span class="token number">60.</span> 
<span class="token number">61.</span>   <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">queueNextTick</span> <span class="token punctuation">(</span><span class="token parameter">cb<span class="token operator">?</span><span class="token punctuation">:</span> Function<span class="token punctuation">,</span> ctx<span class="token operator">?</span><span class="token punctuation">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">62.</span>     <span class="token keyword">let</span> _resolve
<span class="token number">63.</span>     callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token number">64.</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">65.</span>         <span class="token keyword">try</span> <span class="token punctuation">{</span>
<span class="token number">66.</span>           <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
<span class="token number">67.</span>         <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">68.</span>           <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> <span class="token string">'nextTick'</span><span class="token punctuation">)</span>
<span class="token number">69.</span>         <span class="token punctuation">}</span>
<span class="token number">70.</span>       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">71.</span>         <span class="token function">_resolve</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
<span class="token number">72.</span>       <span class="token punctuation">}</span>
<span class="token number">73.</span>     <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token number">74.</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">75.</span>       pending <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token number">76.</span>       <span class="token function">timerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">77.</span>     <span class="token punctuation">}</span>
<span class="token number">78.</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cb <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">79.</span>       <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token number">80.</span>         _resolve <span class="token operator">=</span> resolve
<span class="token number">81.</span>       <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token number">82.</span>     <span class="token punctuation">}</span>
<span class="token number">83.</span>   <span class="token punctuation">}</span>
<span class="token number">84.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre></div><p>首先，先了解nextTick中定义的三个重要变量。</p> <ul><li><p>callbacks 用来存储所有需要执行的回调函数</p></li> <li><p>pending 用来标志是否正在执行回调函数</p></li> <li><p>timerFunc 用来触发执行回调函数</p></li></ul> <p>接下来，了解nextTickHandler()函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1.</span> <span class="token keyword">function</span> <span class="token function">nextTickHandler</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">2.</span>     pending <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token number">3.</span>     <span class="token keyword">const</span> copies <span class="token operator">=</span> callbacks<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token number">4.</span>     callbacks<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">5.</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> copies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token number">6.</span>       copies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">7.</span>     <span class="token punctuation">}</span>
<span class="token number">8.</span>   <span class="token punctuation">}</span>
<span class="token number">9.</span> 
</code></pre></div><p>这个函数用来执行callbacks里存储的所有回调函数。</p> <ul><li>接下来是将触发方式赋值给timerFunc。</li> <li>先判断是否原生支持promise，如果支持，则利用promise来触发执行回调函数；</li> <li>否则，如果支持MutationObserver，则实例化一个观察者对象，观察文本节点发生变化时，触发执行所有回调函数。</li> <li>如果都不支持，则利用setTimeout设置延时为0。</li></ul> <p>最后是queueNextTick函数。因为nextTick是一个即时函数，所以queueNextTick函数是返回的函数，接受用户传入的参数，用来往callbacks里存入回调函数。
<img src="https://upload-images.jianshu.io/upload_images/3985563-a9e7d48417e3900f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/902/format/webp" alt="执行流程"></p> <p>上图是整个执行流程，关键在于timeFunc()，该函数起到延迟执行的作用。</p> <p>从上面的介绍，可以得知timeFunc()一共有三种实现方式。</p> <ul><li>Promise</li> <li>MutationObserver</li> <li>setTimeout</li></ul> <p>其中Promise和setTimeout很好理解，是一个异步任务，会在同步任务以及更新DOM的异步任务之后回调具体函数。</p> <p>下面着重介绍一下MutationObserver。</p> <p>MutationObserver是HTML5中的新API，是个用来监视DOM变动的接口。他能监听一个DOM对象上发生的子节点删除、属性修改、文本内容修改等等。
调用过程很简单，但是有点不太寻常：你需要先给他绑回调：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> mo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
</code></pre></div><p>通过给MutationObserver的构造函数传入一个回调，能得到一个MutationObserver实例，这个回调就会在MutationObserver实例监听到变动时触发。</p> <p>这个时候你只是给MutationObserver实例绑定好了回调，他具体监听哪个DOM、监听节点删除还是监听属性修改，还没有设置。而调用他的observer方法就可以完成这一步:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1.</span> <span class="token keyword">var</span> domTarget <span class="token operator">=</span> 你想要监听的dom节点
<span class="token number">2.</span> mo<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>domTarget<span class="token punctuation">,</span> <span class="token punctuation">{</span>
<span class="token number">3.</span>       characterData<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">//说明监听文本内容的修改。</span>
<span class="token number">4.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>在nextTick中 MutationObserver的作用就如上图所示。在监听到DOM更新后，调用回调函数。</p> <h1 id="vv"><a href="#vv" class="header-anchor">#</a> VV</h1> <h2 id="part-2"><a href="#part-2" class="header-anchor">#</a> part 2</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1.</span> <span class="token keyword">var</span> domTarget <span class="token operator">=</span> 你想要监听的dom节点
<span class="token number">2.</span> mo<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>domTarget<span class="token punctuation">,</span> <span class="token punctuation">{</span>
<span class="token number">3.</span>       characterData<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">//说明监听文本内容的修改。</span>
<span class="token number">4.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="四、nexttick源码浅析"><a href="#四、nexttick源码浅析" class="header-anchor">#</a> 四、nextTick源码浅析</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1.</span> <span class="token keyword">var</span> domTarget <span class="token operator">=</span> 你想要监听的dom节点
<span class="token number">2.</span> mo<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>domTarget<span class="token punctuation">,</span> <span class="token punctuation">{</span>
<span class="token number">3.</span>       characterData<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">//说明监听文本内容的修改。</span>
<span class="token number">4.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="part-3"><a href="#part-3" class="header-anchor">#</a> part 3</h2> <h3 id="五、"><a href="#五、" class="header-anchor">#</a> 五、</h3></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/yi-fish/blog-demo.git/edit/master/blog/Vue.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">11/6/2019, 3:09:57 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog-demo/blog/FirstBlog.html" class="prev">我的第一篇博客</a></span> <span class="next"><a href="/blog-demo/blog/KuaYu.html">JS跨域 内核 闭包</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog-demo/assets/js/app.f512fc54.js" defer></script><script src="/blog-demo/assets/js/2.50c16c5d.js" defer></script><script src="/blog-demo/assets/js/8.4a61413f.js" defer></script>
  </body>
</html>
